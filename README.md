# ğŸš€ NetPulse MultiOptical

NetPulse MultiOptical is a modern network monitoring dashboard for multi-vendor optical / SFP interfaces, designed for ISP and NOC environments.

Built with Laravel 11, featuring real-time interface visibility, SNMP discovery, and an interactive network map.

ğŸ”§ Designed for engineers.
ğŸ›° Built for operations.
ğŸ“¡ Optimized for optical networks.

## âœ¨ Highlights
- ğŸŒ Interactive network map (nodes, links, animated connections)
- ğŸ”¦ Optical/SFP monitoring (TX / RX / attenuation / status)
- ğŸ§­ Device inventory & SNMP interface discovery
- ğŸ§µ OLT monitoring (multi-OLT, multi-PON; tested with HIOSO via Telnet)
- ğŸš¨ Alerts (Telegram notifications + Web UI alert logs)
- ğŸ‘¤ User roles (admin / technician)
- ğŸ” Security activity logs (login success / failed)
- ğŸ¨ Theme customization
- âš¡ Clean API endpoints
- ğŸ—º Visual topology view

## ğŸ§± Tech Stack
- Laravel 11
- PHP 8.2+
- MySQL / MariaDB
- Nginx / Apache
- SNMP
- Vanilla JS + CSS
Optional:
- Node.js (only if rebuilding frontend assets)

## ğŸ“‹ Requirements
- PHP â‰¥ 8.2
- Composer
- MySQL / MariaDB
- Nginx or Apache
- SNMP tools installed on server

## âš¡ Quick Start
1. Install dependencies:
   ```bash
   composer install
   ```

2. Create `.env`:
   ```bash
   cp .env.example .env
   php artisan key:generate
   ```

3. Configure DB in `.env`:
   ```
   DB_CONNECTION=mysql
   DB_HOST=127.0.0.1
   DB_PORT=3306
   DB_DATABASE=netpulse
   DB_USERNAME=...
   DB_PASSWORD=...
   ```

4. Migrate:
   ```bash
   php artisan migrate
   ```

5. Fix permissions (Linux):
   ```bash
   chown -R www-data:www-data storage bootstrap/cache
   chmod -R 775 storage bootstrap/cache
   ```

6. Run:
   ```bash
   php artisan serve
   ```

## âš™ Configuration
Key `.env` variables:
- `APP_URL`
- `APP_TIMEZONE`
- `DB_*`
- `SESSION_DRIVER` (default `file`)

## ğŸ§¬ OLT Configuration (Local)
This project expects a local OLT config file:

1. Copy the example:
   ```bash
   cp config/olt.example.php config/olt.php
   ```

2. Edit `config/olt.php` to match your environment (IP/credentials/vendor options).

Supported keys (per OLT):
- `name`, `host`, `port`, `username`, `password`
- `pons`: list of PON ports, example `['0/1','0/2']`
- `mode`: `epon` (default) or `gpon`
- `enable`: set `false` if your OLT does not need `enable` mode (default `true`)
- `enable_password`: if your OLT prompts an `enable` password (defaults to login `password`)
- `cmd_timeout`: command timeout seconds (default `12`)
- `onu_list_cmd`, `onu_ddm_cmd`: override CLI commands when firmware differs

### HIOSO Notes
HIOSO OLTs are supported via Telnet in `app/Services/OltCollector.php`. If collection returns empty data:
- Make sure `port` matches your device
- If the CLI requires `enable`, keep `enable: true` and set `enable_password` if different
- If the CLI command output differs, override `onu_list_cmd` and `onu_ddm_cmd` to match your firmware
- Debug dumps are written to `storage/app/olt/<oltId>/debug/*.txt` to help adjust parsing/commands

Example HIOSO entry:
```php
<?php
return [
  'olt-hioso-1' => [
    'name' => 'HIOSO-OLT-1',
    'host' => '10.0.0.1',
    'port' => 23,
    'username' => 'your_username',
    'password' => 'your_password',
    'mode' => 'epon',
    'pons' => ['0/1', '0/2', '0/3', '0/4'],
  ],
];
```

## ğŸ§µ OLT Polling (Collect)
The OLT page reads JSON files generated by the collector:
- `storage/app/olt/<oltId>/pon_<pon>.json`
- `storage/app/olt/<oltId>/meta.json`

Run manually:
```bash
php artisan olt:collect olt-hioso-1
php artisan olt:collect-all
```

Scheduler:
- `routes/console.php` schedules `olt:collect-all` every 10 minutes.

Cron helper script:
- `scripts/cron/olt_collect_all.sh` runs `php artisan olt:collect-all` with a lock file and logs to `storage/logs/olt-collect-all.log`.
- Example crontab (every 10 minutes):
  ```bash
  */10 * * * * /var/www/NetpulseMultiOptical/scripts/cron/olt_collect_all.sh
  ```

## ğŸ”„ Data Flow
1. SNMP discovery populates `interfaces` and `interface_stats`.
2. Map nodes and links are stored in `map_nodes` and `map_links`.
3. UI reads via `/api/*` endpoints.

## ğŸ›£ Core Routes
UI:
- `/dashboard`
- `/monitoring`
- `/map`
- `/olt`
- `/devices`
- `/users`
- `/settings`

API (selected):
- `/api/devices`
- `/api/interfaces`
- `/api/monitoring_devices`
- `/api/monitoring_interfaces`
- `/api/interface_chart`
- `/api/map_nodes`
- `/api/map_links`
- `/api/map_devices`
- `/api/settings`
- `/api/olt`
- `/api/olt_data`
- `/api/telegram_test`
- `/api/alert_logs`
- `/api/logs`

## ğŸ” Security Logs
Login activity is written to:
- `storage/logs/security.log`

## ğŸš¨ Alerts (Telegram + Web UI Logs)
Alerts are configured from the **Settings** page and stored in the `settings` table:

- **Settings -> Telegram Bot**:
  - Set `bot_token` and `chat_id`
  - Use "Test Telegram" to verify delivery
- **Settings -> Alert**:
  - Enable/disable channels: Telegram + Web UI logging
  - Choose event types: interface up/down/warning, device up/down
  - Set thresholds (RX warning high/low, RX down threshold)
  - View/Filter/Clear alert logs (stored in `alert_logs` table)

Notes:
- Device up/down transition alerts are emitted when polling runs via CLI (example: `php artisan poll:interfaces`), because it keeps state in `storage/app/alert_state.json`.
- The Security Logs tab reads `storage/logs/security.log` via `/api/logs?type=security` (admin only).

## Permissions (Linux)
```bash
chown -R www-data:www-data storage bootstrap/cache
chmod -R 775 storage bootstrap/cache
```

## â± Cron / Scheduler
If you use scheduled discovery or polling, add:
```bash
* * * * * cd /path/to/project && php artisan schedule:run >> /dev/null 2>&1
```

## ğŸš€ Deployment

### Nginx
```nginx
server {
    listen 80;
    server_name your-domain.com;
    root /path/to/project/public;

    index index.php;
    charset utf-8;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ \.php$ {
        fastcgi_pass unix:/run/php/php8.2-fpm.sock;
        fastcgi_index index.php;
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
        fastcgi_param DOCUMENT_ROOT $realpath_root;
    }

    location ~ /\.(?!well-known).* {
        deny all;
    }
}
```

### Apache
Enable `mod_rewrite`, then use:
```apache
<VirtualHost *:80>
    ServerName your-domain.com
    DocumentRoot /path/to/project/public

    <Directory /path/to/project/public>
        AllowOverride All
        Require all granted
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/netpulse-error.log
    CustomLog ${APACHE_LOG_DIR}/netpulse-access.log combined
</VirtualHost>
```

## ğŸ§ª Development Notes
- JS assets are cacheâ€‘busted via `?v=filemtime(...)`.
- Routes use clean endpoints without `.php`.
- Designed for internal ISP monitoring

## ğŸ“„ License

This project is licensed under CC BY-NC 4.0.
Commercial use is prohibited without permission.
